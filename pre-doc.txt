TODO Sobre el repositorio de configuración. Explicar que es publico pero se adjunta en la entrega la última versión
TODO Sobre el dominio de la organización. Explicar dorayaki.org
TODO Los ficheros de config están comentados explicando funcionalidades
TODO Nombrar todas las máquinas en esquema
TODO: Configurar Servidores DNS para que pueda obtener el nombre de dominio al que pertenece la máquina. Establecer nombre de dominio para cada máquina localmente (domainname comando)
		Configurar DNS de las máquinas para que apunten al DNS del ISP.

# Sobre la conectividad inicial de todas las VMs.

Por defecto cada máquina recien instalada en Virtual Box tiene configurada una tarjeta de red en modo NAT para poder acceder a internet. Usaremos esa tarjeta para tener acceso a internet hasta acabar la configuración de la máquina, cuando desactivaremos dicha interfaz y eliminaremos su configuración. A partir de ese momento seguiriamos teniendo conectividad pero utilizando toda la infraestructura de red desplegada en el escenario.
El script de configuración creado para cada máquina debe ejecutarse teniendo acceso a internet. Por lo que se deberá ejecutar antes de eliminar la interfaz NAT de la máquina virtual y su configuración.

# Sobre la conectividad entre VMs mediante redes internas en Virtual Box.

La conectividad entre máquinas virtuales se ha realizado mediante el uso de redes internas en Virtual Box. Una red interna representa una segmento físico de una red (LAN), actuando el hipervisor como un conmutador de paquetes para todas las interfaces pertenencientes a dicha red virtual.
De esta forma, todas las interfaces conectadas a una misma red interna, simulan interfaces conectadas a un mismo switch, por lo que pueden trasmitirse tramas de forma directa entre ellas. 
#[dibujo_representación_red_interna_virtual_box.jpg https://www.nakivo.com/blog/virtualbox-network-setting-guide/]
Para nuestro escenario, crearemos las siguientes redes internas para emular de la forma más realista posible una topología real con diferentes segmentos físicos de red.

	- red-oficina-dorayaki: LAN compuesta por todas las interfaces de las oficinas de la organización.
	- red-servidores-dorayaki: LAN compuesta por todas las interfaces de la sección de la organicación en la que se ubican los diferentes servicios ofrecidos.
	- red-isp-dorayaki: Representa la LAN del ISP que utiliza la organización para tener acceso a internet. En la práctica esta LAN es usada por el router de la sede Dorayaki y el router del ISP.
	- red-organizacion-externa: LAN compuesta por las interfaces de los dispositivos dentro de la organicación externa.
	- red-isp-organizacion-externa: Representa la LAN del ISP que usa la organicación no confiable para tener acceso a internet. En la práctica esta LAN es usada por el router del ISP y el router del ISP de la orgaización externa.
	- red-isp-auditoria: Representa la LAN del ISP que usa la auditoria para tener acceso a internet. En la práctica esta LAN es usada por el router del ISP y el host del auditor.

Nota: dado que la comunicación entre máquinas va a estar determinada por la enrutación a nivel de red, no sería necesario emular con tanta precisión la topología en en nivel de transporte, pero lo realizamos así con el objetivo de mantener una orgaización adecuada y para facilitar la depuración del escenario si fuese necesario.

# Sobre la organización en subredes y distribución de IPs

El escenario se realiza integramente sobre rangos de IPs privadas para evitar conflictos con IPs públicas reales.
La distribución de subredes se ha realizado de forma que cada subred coincida con una LAN (red interna de VBox) por simplicidad.
Además, hemos elegido rangos que facilitan la comprensión de la topología de red y que permiten una fácil identificación de la subred a la que pertenece una IP.

Dado que las interfaces NAT de Virtual Box utilizan la dirección 10.0.2.15, hemos decidido utilizar IPs en subredes que no contengan dicha dirección para evitar conflictos con el enrutamiento.

Red de Dorayaki:  172.16.0.0/12 -> 172.16.0.0/13 (red-oficina-dorayaki) y 172.24.0.0/13 (red-servidores-dorayaki)
Red de la orgaizacion externa (red-orgaizacion-externa) 192.168.0.0/16
Red del ISP (red-isp-dorayaki) -> 10.12.0.0/16
Red del ISP de la organización externa (red-isp-organizacion-externa) -> 10.13.0.0/16
Red del ISP de la auditoria (red-isp-auditoria) -> 10.14.0.0/16

#[dibujo_topologia_de_red.jpg]
#[esquema_asignacion_ips_subredes.html https://www.davidc.net/sites/default/subnets/subnets.html?network=172.16.0.0&mask=12&division=3.1]
#[esquema_especifico_asignacion_ips_interfaces.jpg]

Para los routers del escenario se ha utilizado netplan para configurar las interfaces de red de forma cómoda, estbleciendose IPs estáticas y tablas de rutas de forma manual.
En escenarios más grandes y complejos puede que fuese necesario utilizar un protocolo de enrutamiento dinámico como OSPF que permita establecer tablas de rutas y DHCP en el router del ISP para configurar las interfaces de los clientes, pero eso queda fuera del ámbito de esta práctica. 
En las interfaces de los routers se han utilizado las direcciones bajas dentro del rango de la subred a la que pertenecen. Además hemos tenido que habilitar el reenvio de paquetes para que las máquinas puedan actuar como routers.

TODO: describir asignación ips para el resto de máquinas.

# Sobre la asignación de MACs para las interfaces de las VMs.

Asignaremos a cada interfaz de cada máquina virtual una MAC única y reconocible para facilitar el análisis de trazas y monitorización de la red. Además, tener una MAC reconocible nos facilitará realizar diferentes configuraciones de red en cada máquina. La asignación de MACs la realizaremos manualmente mediante Virtual Box por comodidad. En un entorno real, bastaría con conocer la MAC grabada fisicamente en la tarjeta de red y configurar el kernel para que la sobreescribiese en cada arranque del sistema.
